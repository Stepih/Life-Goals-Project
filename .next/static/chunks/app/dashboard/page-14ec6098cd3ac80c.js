(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{3537:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eb});var a=s(5155),l=s(2115),r=s(4540),i=s(760),d=s(6408),n=s(6439);let o=(0,n.Z0)({name:"dashboard",initialState:{goals:[],todayTasks:[],userName:"",filterState:{goals:{priority:null,achieved:null},todayTask:"day"}},reducers:{setDashboardData(e,t){e.goals=t.payload.goals,e.todayTasks=t.payload.todayTasks,e.userName=t.payload.userName},setGoalsFilter:(e,t)=>{e.filterState.goals=t.payload},setTodayFilter:(e,t)=>{e.filterState.todayTask=t.payload},getAndUpdateTodayTasks(e,t){e.todayTasks=t.payload},updateTaskCompleted(e,t){let{id:s,completed:a}=t.payload,l=e.todayTasks.find(e=>e.id===s);for(let t of(l&&(l.completed=a),e.goals)){let e=t.tasks.find(e=>e.id===s);if(e){e.completed=a;let s=t.tasks.length>0&&t.tasks.every(e=>e.completed);t.achieved=s;break}}},removeTask(e,t){let{id:s}=t.payload;for(let t of(e.todayTasks=e.todayTasks.filter(e=>e.id!==s),e.goals))if(t.tasks.find(e=>e.id===s)){t.tasks=t.tasks.filter(e=>e.id!==s);let e=t.tasks.length>0,a=t.tasks.every(e=>e.completed);t.achieved=!e||a;break}},createGoal(e,t){e.goals.push(t.payload)},createTask(e,t){let{goalId:s}=t.payload;for(let a=0;a<e.goals.length;a++)if(e.goals[a].id===s){e.goals[a].tasks.push(t.payload),e.goals[a].achieved=!1;break}},removeGoal(e,t){e.goals=e.goals.filter(e=>e.id!==t.payload.id),e.todayTasks=e.todayTasks.filter(e=>e.goalId!==t.payload.id)},updateTask(e,t){let{id:s}=t.payload,a=e.todayTasks.find(e=>e.id===s);a&&(a.title=t.payload.title,a.scheduledFor=t.payload.scheduledFor),e.goals.forEach(e=>{e.tasks.forEach((a,l)=>{a.id===s&&(e.tasks[l]=t.payload)})})},reorderTasks(e,t){let{goalId:s,tasks:a}=t.payload,l=e.goals.find(e=>e.id===s);l&&(l.tasks=a.map((e,t)=>({...e,order:t+1})))},updateGoal(e,t){let{id:s}=t.payload,a=e.todayTasks.find(e=>e.goalId===s);a&&(a.goal={title:t.payload.title}),e.goals.forEach((a,l)=>{a.id===s&&(e.goals[l]=t.payload)})}}}),{setDashboardData:c,setGoalsFilter:x,setTodayFilter:u,updateTaskCompleted:h,reorderTasks:m,getAndUpdateTodayTasks:p,updateTask:f,removeTask:y,createGoal:g,createTask:j,removeGoal:b,updateGoal:v}=o.actions,k=o.reducer,N=(0,n.U1)({reducer:{dashboard:k}});var w=s(5695);let T=e=>{let{children:t,title:s}=e;return(0,a.jsxs)("div",{className:"relative bg-white rounded-xl shadow py-6 px-3 sm:px-6",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:s})}),t]})},C=e=>{let{arrow:t,title:s,onClick:l,reverse:r=!1,active:i=!1}=e;return(0,a.jsxs)("button",{onClick:l,className:"cursor-pointer bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm\n        ".concat(i?"bg-blue-200 text-blue-800 font-semibold":"","\n      "),children:[s,i&&t&&(0,a.jsx)("i",{className:"fas fa-arrow ".concat(r?"fa-arrow-up":"fa-arrow-down"," ml-2")})]})},S=e=>{let t={max:0,mid:0,min:0};return e.forEach(e=>{e.tasks.forEach(e=>{t[e.priority]++})}),t},E=e=>{let t={max:0,mid:0,min:0};return e.forEach(e=>{t[e.priority]++}),t},A=(e,t,s)=>{let a=[...e];if("priority"===t){let e=e=>"max"===e?3:"mid"===e?2:1;a.sort((t,s)=>e(s.priority)-e(t.priority))}else"achieved"===t&&a.sort((e,t)=>{let s=e.tasks.filter(e=>e.completed).length,a=t.tasks.filter(e=>e.completed).length,l=e.tasks.length,r=t.tasks.length;return(0===l?0:s/l)-(0===r?0:a/r)});return s?a.reverse():a},D=()=>{let[e,t]=(0,l.useState)(!1),{goals:s,todayTasks:i}=(0,r.d4)(e=>e.dashboard),{todayTask:d}=(0,r.d4)(e=>e.dashboard.filterState),[n,o]=(0,l.useState)({max:0,mid:0,min:0}),c=(0,l.useCallback)(()=>e?E(i):S(s),[e,s,i]);return(0,l.useEffect)(()=>{o(c())},[c]),(0,a.jsxs)(T,{title:"".concat(e?"day"===d?"Задачи сегодня":"month"===d?"Задачи на месяц":"Задачи на неделю":"Всего"),children:[(0,a.jsx)("div",{className:"flex justify-end -mt-10 mb-5",children:(0,a.jsx)(C,{arrow:!1,onClick:()=>t(e=>!e),title:"\n                ".concat(e?"Всего":"day"===d?"За сегодня":"month"===d?"За месяц":"За неделю")})}),(0,a.jsx)("div",{className:"flex flex-col items-center gap-4 ",children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center mb-4",children:[(0,a.jsxs)("div",{className:"bg-red-50 p-2 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Высокий приоритет"}),(0,a.jsx)("span",{className:"font-semibold",children:n.max})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 p-2 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Средний приоритет"}),(0,a.jsx)("span",{className:"font-semibold",children:n.mid})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-2 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Низкий приоритет"}),(0,a.jsx)("span",{className:"font-semibold",children:n.min})]})]})})]})},I=e=>{let{priority:t,type:s}=e,l="",r="",i="";switch(t){case"min":l="bg-green-100",r="text-green-800",i="Низкий";break;case"mid":l="bg-yellow-100",r="text-yellow-800",i="Средний";break;case"max":l="bg-red-100",r="text-red-800",i="Высокий"}return(0,a.jsx)("span",{className:"".concat(l," ").concat(r," ").concat("small"===s&&"rounded-4xl h-4"," text-xs px-2 py-0.5 rounded-full"),children:"big"===s&&i})},F=e=>{let{title:t,goalTitle:s,priority:l,description:r}=e;return(0,a.jsxs)("div",{className:"overflow-hidden flex justify-between items-start gap-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium",children:t}),s&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:['Для цели "',s,'"']}),r&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Описание: ",r]})]}),(0,a.jsx)(I,{type:"big",priority:l})]})},P=e=>new Date(e).toISOString().split("T")[0],O=e=>{let{scheduledFor:t}=e;return t?(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mt-3",children:[(0,a.jsx)("i",{className:"far fa-clock mr-1"}),P(String(t))]}):null},_=()=>(0,a.jsx)("div",{className:"h-[24px]",children:(0,a.jsx)("i",{className:"fa fa-flag-checkered  text-gray-400"})}),G=!1,L=[],z=e=>{L.forEach(t=>{let{resolve:s,reject:a,url:l,options:r}=t;e?a(e):fetch(l,{...r,credentials:"include"}).then(s).catch(a)}),L=[]};async function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=await fetch(e,{...t,credentials:"include"});if(401!==s.status||G){if(401===s.status&&G)return new Promise((s,a)=>{L.push({resolve:s,reject:a,url:e,options:t})})}else{G=!0;let a=await fetch("/api/refresh",{method:"POST",credentials:"include"});if(a.ok)s=await fetch(e,{...t,credentials:"include"}),z();else{let e=await a.json().catch(()=>({})),t=Error("Unauthorized");t.redirectTo=(null==e?void 0:e.redirectTo)||"/",z(t),(0,w.redirect)(e.redirectTo)}}return s}finally{G=!1}}let J=e=>{let{taskId:t,textCheck:s}=e,i=(0,r.wA)(),d=(0,r.d4)(e=>{let s=e.dashboard.todayTasks.find(e=>e.id===t);if(s)return s.completed;for(let s of e.dashboard.goals){let e=s.tasks.find(e=>e.id===t);if(e)return e.completed}}),[n,o]=(0,l.useState)(!1),c=async()=>{if(void 0!==d){o(!0);try{(await R("/api/tasks/completed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,completed:!d})})).ok&&i(h({id:t,completed:!d}))}catch(e){}finally{o(!1)}}};return void 0===d?null:(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,a.jsx)("input",{className:"cursor-pointer",type:"checkbox",checked:d,disabled:n,onChange:c}),s&&(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Выполнено"})]})},q=e=>{let{click:t}=e;return(0,a.jsx)("button",{onClick:t,className:"cursor-pointer text-gray-400 hover:text-gray-600 edit-daily-task",children:(0,a.jsx)("i",{className:"fas fa-edit"})})},U=e=>{let{taskId:t,onEdit:s,isCompleted:l}=e;return(0,a.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,a.jsx)(J,{textCheck:!0,taskId:t}),l?(0,a.jsx)(_,{}):(0,a.jsx)(q,{click:s})]})};var W=s(4239),M=s(9302),B=s(4083),H=s(6656);function K(e){let{name:t,label:s,value:l,onChange:r,required:i=!1,rows:d=4,cols:n}=e;return(0,a.jsxs)("div",{children:[s&&(0,a.jsx)(H.A,{htmlFor:t,children:s}),(0,a.jsx)("textarea",{id:t,name:t,className:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:l,onChange:r,required:i,rows:d,cols:n})]})}function X(e){let{name:t,label:s,value:l,onChange:r,options:i,required:d=!1}=e;return(0,a.jsxs)("div",{children:[s&&(0,a.jsx)(H.A,{htmlFor:t,children:s}),(0,a.jsx)("select",{id:t,name:t,value:l,onChange:r,required:d,className:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:i.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})}s(5279);var Y=s(4776);let Z=e=>{let t,s,{type:d,goalId:n,updateData:o}=e,c=(0,r.d4)(e=>e.dashboard.filterState.todayTask),x=e=>"goalId"in e;"createGoal"===d?(s={title:o&&!x(o)?o.title:"",description:o&&!x(o)?o.description:"",priority:o?o.priority:"min"},t=o?"goals/update":"goals/".concat(d)):(s={title:o&&x(o)?o.title:"",goalId:null!=n?n:null,scheduledFor:o&&x(o)?o.scheduledFor:new Date,priority:o?o.priority:"min",description:o?o.description:""},t=o?"tasks/update":"tasks/".concat(d));let[u,h]=(0,l.useState)(s),[m,y]=(0,l.useState)(""),[b,k]=(0,l.useState)(""),[N,w]=(0,l.useState)(!1),T=(0,r.wA)(),C=async e=>{e.preventDefault(),y(""),k(""),w(!0);try{let e=await R("/api/".concat(t),{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...u,id:null==o?void 0:o.id})}),s=await e.json();if(e.ok)if(k("Успешно!"),x(s)){let e=await R("/api/tasks/today?range=".concat(c),{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();o?T(f(s)):T(j(s)),T(p(t))}else o?T(v(s)):T(g(s));else y("Ошибка")}catch(e){y("Произошла ошибка запроса")}finally{w(!1)}},S=e=>{h(t=>({...t,[e.target.name]:e.target.value}))},E=(0,a.jsx)(X,{name:"priority",label:"Приоритет *",value:u.priority,onChange:e=>h(t=>({...t,priority:e.target.value})),options:[{value:"min",label:"Минимальный"},{value:"mid",label:"Средний"},{value:"max",label:"Максимальный"}]});return(0,a.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:C,children:[(0,a.jsx)(M.A,{required:!0,name:"title",type:"text",label:"Название *",value:u.title,onChange:S}),(0,a.jsx)(K,{name:"description",label:"Описание",value:u.description?u.description:"",onChange:S}),x(u)?(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)("label",{htmlFor:"scheduledFor",className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата"}),(0,a.jsx)(W.Ay,{id:"scheduledFor",selected:u.scheduledFor,onChange:e=>{h(t=>({...t,scheduledFor:e}))},dateFormat:"yyyy-MM-dd",placeholderText:"Выберите дату",className:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsx)("div",{className:"w-1/2",children:E})]}):(0,a.jsx)(a.Fragment,{children:E}),(0,a.jsx)(B.A,{loading:N,children:"Сохранить"}),(0,a.jsxs)(i.N,{children:[m&&(0,a.jsx)(Y.A,{error:m}),b&&(0,a.jsx)(Y.A,{success:b})]})]})};var Q=s(7650);function V(e){let{children:t,onClose:s,title:r}=e,[i,d]=(0,l.useState)(!1);return((0,l.useEffect)(()=>d(!0),[]),i)?(0,Q.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex justify-center items-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 relative max-w-lg w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:r}),(0,a.jsx)("button",{onClick:s,className:"cursor-pointer text-gray-500 hover:text-gray-700",children:(0,a.jsx)("i",{className:"fas fa-times"})})]}),t]})}),document.body):null}let $=e=>{var t;let{task:s}=e,[r,i]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"mb-8 p-4 rounded-lg border border-gray-200 transform-gpu will-change-transform antialiased transition-all duration-300 hover:-translate-y-[5px] hover:shadow-[0_5px_10px_rgba(0,0,0,0.1)]",children:[(0,a.jsx)(F,{description:s.description,priority:s.priority,title:s.title,goalTitle:null==(t=s.goal)?void 0:t.title}),(0,a.jsx)(O,{scheduledFor:s.scheduledFor}),(0,a.jsx)(U,{taskId:s.id,isCompleted:s.completed,onEdit:()=>{i(!0)}}),r&&(0,a.jsx)(V,{title:"Изменить задачу",onClose:()=>i(!1),children:(0,a.jsx)(Z,{type:"createTask",goalId:s.goalId,updateData:s})})]})};var ee=s(5294);let et=e=>{let{click:t}=e;return(0,a.jsx)("button",{onClick:t,className:"cursor-pointer",children:(0,a.jsx)("i",{className:"fas fa-trash text-gray-500 hover:text-red-600 transition"})})},es=e=>{let{idTask:t}=e,s=(0,r.wA)(),l=async()=>{try{(await R("/api/tasks/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})})).ok&&s(y({id:t}))}catch(e){}finally{}};return(0,a.jsx)(et,{click:l})},ea=e=>{let{task:t,isDrug:s}=e,[r,i]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"relative my-3 p-3 flex items-center justify-between ".concat(s?"bg-grey":"bg-white","  rounded-lg border border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-h-[24px]",children:[!s&&(0,a.jsx)(J,{taskId:t.id}),(0,a.jsx)("h2",{className:"font-bold text-xs",children:t.title}),s&&(0,a.jsx)("div",{className:"font-bold text-2xs absolute right-2 top-1/2 transform -translate-x-1/2 -translate-y-1/2",children:t.order})]}),!s&&(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(I,{priority:t.priority,type:"small"}),t.completed?(0,a.jsx)(_,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q,{click:()=>{i(!0)}}),(0,a.jsx)(es,{idTask:t.id})]})]}),r&&(0,a.jsx)(V,{title:"Изменить задачу",onClose:()=>i(!1),children:(0,a.jsx)(Z,{type:"createTask",goalId:t.goalId,updateData:t})})]})},el=e=>{let{goalId:t}=e,s=(0,r.wA)(),[i,d]=(0,l.useState)(!1),n=(0,r.d4)(e=>{var s;return(null==(s=e.dashboard.goals.find(e=>e.id===t))?void 0:s.tasks)||[]}),o=()=>{R("/api/tasks/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.map((e,t)=>({id:e.id,order:t+1})))})},c=(0,l.useRef)(0),x=()=>{1===c.current?(c.current=0,d(!1),o()):(c.current=1,d(!0))};return(0,a.jsx)(ee.JY,{onDragEnd:e=>{if(!e.destination)return;let a=Array.from(n),[l]=a.splice(e.source.index,1);a.splice(e.destination.index,0,l),s(m({goalId:t,tasks:a}))},children:(0,a.jsx)(ee.gL,{droppableId:"tasks",children:e=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,children:[n.map((e,t)=>(0,a.jsx)(ee.sx,{isDragDisabled:!i,draggableId:e.id,index:t,children:t=>(0,a.jsx)("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,className:"mb-2",onDoubleClick:x,children:(0,a.jsx)(ea,{isDrug:i,task:e})})},e.id)),e.placeholder]})})})},er=e=>{let{type:t,tasks:s}=e;return"mini"===t?0===s.length?(0,a.jsx)("div",{className:"p-5 bg-zinc-50",children:(0,a.jsx)("h4",{className:"text-center py-2 text-gray-500 text-sm",children:"Нет задач"})}):(0,a.jsx)("div",{children:e.goalId&&(0,a.jsx)(el,{goalId:e.goalId})}):"full"===e.type?0===s.length?(0,a.jsxs)("div",{className:"p-5 text-center text-gray-500",children:[(0,a.jsx)("i",{className:"fas fa-check-circle text-3xl mb-1"}),(0,a.jsx)("h4",{className:"py-2  text-sm",children:"Задач нет"})]}):(0,a.jsx)("div",{children:s.map((e,t)=>(0,a.jsx)($,{task:e},t))}):null},ei=e=>{let{filters:t}=e,[s,r]=(0,l.useState)(!1),[i,d]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{let e=()=>{r(window.innerWidth<500)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t.length)?(0,a.jsx)("div",{className:"relative",children:s?(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{className:"text-xl",onClick:()=>d(e=>!e),children:(0,a.jsx)("i",{className:"fa-solid fa-sliders"})}),i&&(0,a.jsx)("div",{style:{right:"100%"},className:"absolute z-10 mt-2 bg-white border border-gray-200 rounded-lg shadow-md p-2 w-40",children:t.map((e,t)=>(0,a.jsx)("div",{className:"my-3 flex",children:(0,a.jsx)(C,{reverse:e.reverse,active:e.active,title:e.title,onClick:()=>{e.onClick(),d(!1)},arrow:e.arrow})},e.key+t))})]}):(0,a.jsx)("div",{className:"flex gap-2",children:t.map((e,t)=>(0,a.jsx)(C,{arrow:e.arrow,reverse:e.reverse,active:e.active,title:e.title,onClick:e.onClick},e.key+t))})}):null},ed=e=>{let{isLoading:t,error:s}=e,l=(0,r.wA)(),{todayTasks:i}=(0,r.d4)(e=>e.dashboard),d=(0,r.d4)(e=>e.dashboard.filterState.todayTask),n=async e=>{let t=await R("/api/tasks/today?range=".concat(e));t.ok&&(l(p(await t.json())),l(u(e)))};return t?(0,a.jsx)(T,{title:"Задачи на сегодня",children:(0,a.jsx)("div",{className:"p-4 text-center",children:"Загрузка задач..."})}):s?(0,a.jsx)(T,{title:"Задачи на сегодня",children:(0,a.jsxs)("div",{className:"p-4 text-red-500",children:["Ошибка: ",s,(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-2 text-blue-500 hover:text-blue-700",children:"Попробовать снова"})]})}):(0,a.jsxs)(T,{title:"Задачи на ".concat("day"===d?"сегодня":"month"===d?"месяц":"неделю"),children:[(0,a.jsx)("div",{className:"flex gap-2 justify-end -mt-10 mb-5",children:(0,a.jsx)(ei,{filters:[{key:"todayTask",title:"День",value:"day",active:"day"===d,onClick:()=>n("day"),arrow:!1},{key:"todayTask",title:"Неделя",value:"week",active:"week"===d,onClick:()=>n("week"),arrow:!1},{key:"todayTask",title:"Месяц",value:"month",active:"month"===d,onClick:()=>n("month"),arrow:!1}]})}),(0,a.jsx)(er,{type:"full",tasks:i})]})},en=e=>{let{goalId:t}=e,s=(0,r.wA)(),l=async()=>{try{(await R("/api/goals/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})})).ok&&s(b({id:t}))}catch(e){}finally{}};return(0,a.jsx)(et,{click:l})},eo=e=>{let{goal:t}=e,[s,r]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"p-4 mt-5 -mx-4 rounded-b-lg border-t border-gray-200 px-4 py-3 bg-gray-50",children:[s&&(0,a.jsx)(V,{title:"Новая задача",onClose:()=>r(!1),children:(0,a.jsx)(Z,{goalId:t.id,type:"createTask"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-normal",children:"Задачи"}),(0,a.jsxs)("button",{onClick:()=>r(!0),className:"cursor-pointer text-blue-600 hover:text-blue-800 text-sm font-medium add-task",children:[(0,a.jsx)("i",{className:"fas fa-plus mr-1"}),"Добавить"]})]}),(0,a.jsx)(er,{goalId:t.id,tasks:t.tasks,type:"mini"})]})},ec=e=>{let{progress:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between font-medium rounded",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Прогресс"}),(0,a.jsxs)("span",{children:[t,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(t,"%")}})})]})},ex=e=>{let{goal:t}=e,[s,r]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"".concat(t.achieved?"opacity-50":"opacity-100"," p-4 pb-0 relative rounded-lg border border-gray-200 transition-all duration-300 transform-gpu will-change-transform antialiased hover:-translate-y-[5px] hover:shadow-[0_5px_10px_rgba(0,0,0,0.1)]"),children:[(0,a.jsxs)("div",{className:"relative ",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h2",{className:"block max-w-[80%] font-semibold text-lg break-words",children:t.title}),(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)(I,{type:"big",priority:t.priority}),(0,a.jsx)(q,{click:()=>r(!0)}),(0,a.jsx)(en,{goalId:t.id})]})]}),(0,a.jsx)("span",{className:"block text-sm text-gray-500 mb-4",children:t.description}),(0,a.jsx)(ec,{progress:(()=>{let e=t.tasks.length,s=0;return t.tasks.forEach(e=>{e.completed&&(s+=1)}),s?Math.round(s/e*100):s})()})]}),(0,a.jsx)(eo,{goal:t}),s&&(0,a.jsx)(V,{title:"Изменить цель",onClose:()=>r(!1),children:(0,a.jsx)(Z,{type:"createGoal",updateData:t})})]})},eu=e=>{let{goals:t}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-8",children:t.map(e=>(0,a.jsx)(ex,{goal:e},e.id))})},eh=e=>{let{onClick:t,title:s="",className:l=""}=e;return(0,a.jsxs)("button",{onClick:t,className:"cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg flex items-center ".concat(l),children:[(0,a.jsx)("i",{className:"fas fa-plus text-2xs"}),s]})},em=e=>{let{isLoading:t,error:s}=e,i=(0,r.wA)(),d=(0,r.d4)(e=>e.dashboard.goals),n=(0,r.d4)(e=>e.dashboard.filterState.goals),[o,c]=(0,l.useState)(d),[u,h]=(0,l.useState)({priority:!1,achieved:!1}),[m,p]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=[...d];n.priority&&(e=A(e,"priority",u.priority)),n.achieved&&(e=A(e,"achieved",u.achieved)),c(e)},[d,n,u]);let f=e=>{n[e]?u[e]?(i(x({...n,[e]:!1})),h({...u,[e]:!1})):h({...u,[e]:!0}):(i(x({...n,[e]:!0})),h({...u,[e]:!1}))};return t?(0,a.jsx)(T,{title:"Мои цели",children:(0,a.jsx)("div",{children:"Загрузка..."})}):s?(0,a.jsx)(T,{title:"Мои цели",children:(0,a.jsxs)("div",{className:"text-red-500",children:["Ошибка: ",s]})}):(0,a.jsxs)(T,{title:"Мои цели",children:[(0,a.jsx)("div",{className:"mb-4 flex justify-end items-center gap-2 -mt-10",children:(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[0!==o.length&&(0,a.jsx)(eh,{onClick:()=>p(!0)}),d.length>1&&(0,a.jsx)(ei,{filters:[{key:"priority",title:"По приоритету",active:n.priority,reverse:u.priority,onClick:()=>f("priority"),arrow:!0},{key:"achieved",title:"По выполнению",active:n.achieved,reverse:u.achieved,onClick:()=>f("achieved"),arrow:!0}]})]})}),m&&(0,a.jsx)(V,{title:"Новая цель",onClose:()=>p(!1),children:(0,a.jsx)(Z,{type:"createGoal"})}),0===o.length?(0,a.jsxs)("div",{className:"text-center py-10 text-gray-500",children:[(0,a.jsx)("i",{className:"fas fa-bullseye text-4xl mb-3"}),(0,a.jsx)("p",{className:"",children:"У вас пока нет целей"}),(0,a.jsx)("button",{onClick:()=>p(!0),className:"cursor-pointer mt-4 text-blue-600 hover:text-blue-800 font-medium",children:"Создать первую цель"})]}):(0,a.jsx)(eu,{goals:o})]})},ep=e=>{let{isLoading:t}=e,[s,r]=(0,l.useState)(!0),[n,o]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setTimeout(()=>{o(!0)},1e3);return()=>clearTimeout(e)},[]),(0,l.useEffect)(()=>{!t&&n&&r(!1)},[t,n]),(0,a.jsx)(i.N,{children:s&&(0,a.jsx)(d.P.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:0},transition:{duration:.4},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-black text-3xl sm:text-5xl font-semibold text-center z-50",children:"Добро пожаловать!"})})};function ef(){let e=async e=>{e.preventDefault();let t=await fetch("/api/logout",{method:"POST"}),s=await t.json();(0,w.redirect)(s.redirectTo)};return(0,a.jsx)("button",{onClick:e,className:"cursor-pointer flex items-center gap-2 text-red-500 hover:text-red-600",children:(0,a.jsx)("i",{className:"fas fa-sign-out-alt"})})}let ey=()=>{let{userName:e}=(0,r.d4)(e=>e.dashboard);return(0,a.jsx)("div",{className:"relative bg-white rounded-xl shadow py-6 px-3 sm:px-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("h2",{className:"text-3xs sm:text-xl font-semibold text-gray-800",children:["Привет, ",e," \uD83D\uDC4B"]})}),(0,a.jsx)(ef,{})]})})},eg=()=>{let[e,t]=(0,l.useState)([]),{todayTasks:s}=(0,r.d4)(e=>e.dashboard);(0,l.useEffect)(()=>{(async()=>{try{let e=await R("/api/productivity/weekly",{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=(await e.json()).map(e=>({...e,date:P(e.date)}));t(s)}else t([])}catch(e){t([])}})()},[s]);let i=Math.max(...e.map(e=>e.completedTasks),1);return 0===e.length?(0,a.jsx)(T,{title:"Продуктивность за неделю",children:(0,a.jsx)("div",{className:"text-gray-500 text-sm text-center w-full",children:(0,a.jsx)("span",{className:"",children:"УПС! Тут пока пусто"})})}):(0,a.jsx)(T,{title:"Продуктивность за неделю",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-full h-[180px] flex gap-2 items-end justify-s",children:e.map(e=>{let{date:t,completedTasks:s}=e,l=s/i*160;return(0,a.jsxs)("div",{title:"".concat(t,": ").concat(s," выполнено"),className:"flex flex-col items-center",style:{flex:1,minWidth:20,maxWidth:32},children:[(0,a.jsx)("div",{className:"bg-blue-500 rounded-t w-full",style:{height:"".concat(l,"px")}}),(0,a.jsx)("div",{className:"text-xs text-center text-blue-700 mt-1 select-none",children:s})]},t)})}),(0,a.jsx)("div",{className:"w-full flex gap-2 mt-2",children:e.map(e=>{let{date:t}=e;return(0,a.jsx)("div",{className:"text-[10px] text-center text-gray-700 select-none",style:{flex:1,minWidth:20,maxWidth:32},children:new Date(t).toLocaleDateString("ru-RU",{weekday:"short"})},t)})})]})})};function ej(){let e=(0,r.wA)(),t=(0,w.useRouter)(),{userName:s}=(0,r.d4)(e=>e.dashboard),[n,o]=(0,l.useState)(!0),[x,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)(null);return(0,l.useEffect)(()=>{!async function(){try{o(!0);let t=await R("/api/dashboard");t.ok;let s=await t.json();e(c(s)),m(null)}catch(e){m(e.message),e.message.includes("NEXT_REDIRECT")&&t.push("/")}finally{o(!1)}}()},[e,t]),(0,l.useEffect)(()=>{if(!n){let e=setTimeout(()=>u(!0),1e3);return()=>clearTimeout(e)}},[n]),(0,a.jsxs)("section",{children:[(0,a.jsx)(ep,{userEmail:s,isLoading:n}),(0,a.jsx)(i.N,{children:x&&(0,a.jsxs)(d.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.4,ease:"easeOut"},className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(ey,{}),(0,a.jsx)(ed,{isLoading:!1,error:h}),(0,a.jsx)(em,{isLoading:!1,error:h})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(D,{}),(0,a.jsx)(eg,{})]})]},"dashboard-content")})]})}function eb(){return(0,a.jsx)(r.Kq,{store:N,children:(0,a.jsx)(ej,{})})}},4083:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155);function l(e){let{loading:t,children:s}=e;return(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white font-bold cursor-pointer py-2 px-5 rounded hover:bg-blue-700 flex items-center justify-center",disabled:t,children:t?(0,a.jsx)("div",{className:"h-6 w-6 border-3 border-white border-t-transparent rounded-full animate-spin"}):s})}},4776:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var a=s(5155),l=s(2115),r=s(7650),i=s(6408);function d(e){let{error:t,success:s}=e,[d,n]=(0,l.useState)(!1);if((0,l.useEffect)(()=>n(!0),[]),!d)return null;let o=null!=t?t:s;return(0,r.createPortal)((0,a.jsx)(i.P.div,{initial:{y:-100},animate:{y:20},exit:{y:-100},className:"fixed top-0 left-1/2 transform translate-x-[-50%] z-50",children:(0,a.jsx)("div",{className:"".concat(t&&"bg-red-700"," ").concat(s&&"bg-green-700"," rounded-lg shadow-lg p-6 relative max-w-lg w-full"),children:(0,a.jsx)("h1",{className:"font-bold text-white",children:o})})}),document.body)}},5994:(e,t,s)=>{Promise.resolve().then(s.bind(s,3537))},6656:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155);let l=e=>{let{htmlFor:t,children:s,className:l=""}=e;return(0,a.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1 ".concat(l),children:s})}},9302:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155),l=s(6656);function r(e){let{name:t,type:s,label:r,value:i,onChange:d,required:n=!1}=e;return(0,a.jsxs)("div",{children:[r&&(0,a.jsx)(l.A,{htmlFor:t,children:r}),(0,a.jsx)("input",{id:t,name:t,type:s,className:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i,onChange:d,required:n})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[302,545,579,309,941,26,441,684,358],()=>t(5994)),_N_E=e.O()}]);